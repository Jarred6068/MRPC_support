---
title: "Write-Up ADDIS Re-run and Verification"
subtitle: 'University of Idaho Department of Statistical Science'
author: "Jarred Kvamme"
date: '2/25/2021'
output:
  pdf_document: default
  html_document: default
  word_document: default
fontsize: 10pt
bibliography: biblies.bib
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=12, fig.height=8)
```



\section*{Re-analysis of GTEx Using MRPC-ADDIS}

\subsection*{DETAILED DESCRIPTION:}    

\textbf{(1)} Implementation of the ADDIS improvement to the MRPC algorithm: This involved adapting the existing scripts developed by M. Badsha to rerun the GTEx data using the ADDIS version of the FDR control. \textbf{(2)} The distribution of model types (M0, M1, ... M4, Other) relative to each tissue was retained from the analyses for both \textbf{ MRPC-LOND} and \textbf{ MRPC-ADDIS} for comparison. Additionally, a host of programs were developed to identify the specific classification of each trio analyzed in each tissue.\textbf{(3)} These programs were further adapted to identify the number of trios for each tissue classified as cis or trans mediated (M1 type 1 or M1 type 2). Such information was again compared with results from \textbf{MRPC LOND} with the intention of understanding the differences in inferred networks between the two FDR control methods.
  


\section*{MAIN POINTS:}

\subsection*{(1) Re-run of GTEx data with MRPC using the ADDIS FDR control}    
$\bullet$ Used the general format of the scripts created by M.Badsha to run MRPC on GTEx data for all available tissues.    
$\bullet$ created a looped version of the script which runs and outputs the list of classifications and model counts for each table for seemless re-analysis

\subsection*{(2) Summarizing of differences between LOND and ADDIS}   
$\bullet$ The distribution of trio classifications for each tissue were quantified as the number of trios (counts) allocated to each model type (M0, M1, ... M4, Other)    
$\bullet$ These counts compared numerically and visually to further analyze differences between distribution of model types between \textbf{ADDIS} and \textbf{LOND}    
$\bullet$ Lastly, we followed up on differences between FDR methods at a finer level by investigating classification changes of individual trios and differences between their adjacency matrix    

\subsection*{(3) Summarizing differences between LOND and ADDIS - Cis/Trans Mediation models}
$\bullet$ We extracted the M1 classified trios for both \textbf{ADDIS} and \textbf{LOND} and classified them as Type-1 (cis mediated) and Type-2 (trans-mediated) by the structure of the adjacency matrix    
$\bullet$ constructed a table of the frequency (counts) and relative proportion of M1-Type-1 and M2-Type-2 mediation models for each method and all tissues    
$\bullet$ Summarized and compared mediation model trios of (Type-1,Type-2) numerically and visually for both \textbf{ADDIS} and \textbf{LOND}    

\newpage
\subsection*{Summarizing Information For LOND/ADDIS Comparisons}
```{r, fig.cap="Density plots showing the distribution of each graph type under both ADDIS and LOND", echo=FALSE, warning=FALSE, message=FALSE}
rraddis<- read.csv("C:/Users/Bruin/Desktop/Research Assistantship/ADDIS_ReRun/ReRunADDIS_Summary.csv")
rrlond<- read.csv("C:/Users/Bruin/Desktop/Research Assistantship/ADDIS_ReRun/ReRunLOND_Summary.csv")
nam=c("M0","M1","M2","M3","M4","Other")
modcts=rraddis[,c(6:11)]
colnames(modcts)=nam
modcts2=rrlond[,c(6:11)]
colnames(modcts2)=nam
modpcts=rraddis[,c(12:17)]
colnames(modpcts)=nam
modpcts2=rrlond[,c(12:17)]
colnames(modpcts2)=nam

L=rep("LOND", dim(modcts2)[1])
A=rep("ADDIS", dim(modcts)[1])

AplusL=c(A,L)

#pairs(modcts)
#pairs(modcts2)

plot.list=list()

# par(mfrow=c(2,3))
# for(i in 1:6){
#   hist(modcts[,i],main = paste("histogram of:", nam[i], sep = " "))
# }
# par(mfrow=c(1,1))




library(ggplot2)
for(i in 1:6){

  df=cbind.data.frame( FDR=as.factor(AplusL), M=c(modcts[,i], modcts2[,i]))
  
  plot.list[[i]]=ggplot(df, aes(x=M, color=FDR, fill=FDR)) +geom_density(alpha=0.3)+
    ggtitle(label = paste("Density plot for:", nam[i], sep = " "))
    
}


library(gridExtra)
grid.arrange(grobs=plot.list,nrows=3, ncol=2)
```






```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(knitr)

#change table
average.change.ct=colMeans(modcts-modcts2)
average.change.ct.sd=apply(modcts-modcts2, 2, sd)
average.change.pct=colMeans(modpcts-modpcts2)
average.change.pct.sd=apply(modpcts-modpcts2,2,sd)

change.table=rbind.data.frame(average.change.ct, average.change.ct.sd, 
                              average.change.pct, average.change.pct.sd)
colnames(change.table)=nam
row.names(change.table)=c("mean.change.ct", "SD.change.ct", "mean.change%", "SD.change%")

kable(change.table, caption = "table of the average difference in count and percentage between ADDIS and LOND and their standard errors for the differences", digits = 5)

```



```{r, echo=FALSE, warning=FALSE, message=FALSE, eval=FALSE}
#Bootstrap CI's

Addis.cIs=as.data.frame(matrix(0, nrow = 6, ncol = 3))
colnames(Addis.cIs)=c("lower.limit", "mean","upper.limit")
row.names(Addis.cIs)=nam
B=1000
alpha=0.05


#calculate confidence interval for each model type avg count(ADDIS)
for(i in 1:6){
  bsdata=rep(0,B)
  
  for(j in 1:B){
    
    bsdata[j]=mean(sample(modcts[,i], dim(modcts)[1], replace = TRUE))
    
  }
  
  #hist(bsdata)
  SE=sd(bsdata)
  M=mean(bsdata)
  lower=M-qnorm(1-alpha/2)*(SE/sqrt(length(bsdata)))
  upper=M+qnorm(1-alpha/2)*(SE/sqrt(length(bsdata)))
  
  Addis.cIs[i,]=round(c(lower,M,upper),3)
}



Lond.cIs=as.data.frame(matrix(0, nrow = 6, ncol = 3))
colnames(Lond.cIs)=c("lower.limit", "mean","upper.limit")
row.names(Lond.cIs)=nam
#calculate confidence interval for each model type avg count(LOND)
for(i in 1:6){
  bsdata=rep(0,B)
  
  for(j in 1:B){
    
    bsdata[j]=mean(sample(modcts2[,i], dim(modcts2)[1], replace = TRUE))
    
  }
  
  #print(bsdata)
  #hist(bsdata, breaks = 15)
  SE=sd(bsdata)
  M=mean(bsdata)
  lower=M-qnorm(1-alpha/2)*(SE/sqrt(length(bsdata)))
  upper=M+qnorm(1-alpha/2)*(SE/sqrt(length(bsdata)))
  
  Lond.cIs[i,]=round(c(lower,M,upper),3)
}


kable(Lond.cIs, caption = "Table of confidence intervals for the average count of each classified graph for all tissues under the LOND FDR control ")
kable(Addis.cIs, caption = "Table of confidence intervals for the average count of each classified graph for all tissues under the ADDIS FDR control ")

```








```{r, fig.cap="Density plots summarizing the differences between the relative counts for model 1 type 1 (M11) and Model 2 type 2 (M12) as well as the total distribution of Model 1's (MT)", echo=FALSE, message=FALSE, warning=FALSE}
#M1-type1 and M2-type2 comparisons

m1sum=read.csv(file="C:/Users/Bruin/Desktop/Research Assistantship/ADDIS_Verify/Complete_M1types_Analysis_ADDIS.csv")

m1sum=m1sum[1:(dim(m1sum)[1]-1),]


#making density plots:
library(ggplot2)
L=rep("LOND", dim(m1sum)[1])
A=rep("ADDIS", dim(m1sum)[1])

AplusL=c(A,L)
plot.list=list()

  
  df=cbind.data.frame( FDR=as.factor(AplusL), M11=c(m1sum[,2], m1sum[,7]), M12=c(m1sum[,3], m1sum[,8]),
                       MT=c(m1sum[,4], m1sum[,9]))
  
  plot.list[[1]]=ggplot(df, aes(x=M11, color=FDR, fill=FDR)) +geom_density(alpha=0.3)+
    ggtitle(label = "Density plot for M1 Type 1")
  
  plot.list[[2]]=ggplot(df, aes(x=M12, color=FDR, fill=FDR)) +geom_density(alpha=0.3)+
    ggtitle(label = "Density plot for M1 Type 2")
  
  plot.list[[3]]=ggplot(df, aes(x=MT, color=FDR, fill=FDR)) +geom_density(alpha=0.3)+
    ggtitle(label = "Density plot for Total M1")
  



library(gridExtra)
grid.arrange(grobs=plot.list,nrows=2, ncol=2)


